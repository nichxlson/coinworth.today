<template>
    <div class="w-1/2 h-[400px] relative">
        <div class="absolute top-6 right-6 flex flex-row items-center">
            <button class="w-[30px] h-[30px] text-sm border border-gray-200 rounded-l" :class="[chartDateRange == '1d' ? 'bg-gray-200': 'bg-white']" @click.prevent="$store.commit('setChartDateRange', '1d')">1d</button>
            <button class="w-[30px] h-[30px] text-sm border border-l-0 border-gray-200" :class="[chartDateRange == '1w' ? 'bg-gray-200': 'bg-white']" @click.prevent="$store.commit('setChartDateRange', '1w')">1w</button>
            <button class="w-[30px] h-[30px] text-sm border border-l-0 border-gray-200" :class="[chartDateRange == '1m' ? 'bg-gray-200': 'bg-white']" @click.prevent="$store.commit('setChartDateRange', '1m')">1m</button>
            <button class="w-[30px] h-[30px] text-sm border border-l-0 border-gray-200 rounded-r" :class="[chartDateRange == '1y' ? 'bg-gray-200': 'bg-white']" @click.prevent="$store.commit('setChartDateRange', '1y')">1y</button>
        </div>

        <line-chart :data="data" :options="chartOptions()" v-if="loaded"/>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                loaded: false,
                data: [],
                options: [],
            }
        },

        methods: {
            getData() {
                let that = this;

                let date = that.$moment();

                let coin = this.selectedCoin || 'BTC',
                    startDate = date.clone().subtract(1, 'day').format('YYYY-MM-DDTHH:mm'),
                    endDate = date.clone().format('YYYY-MM-DDTHH:mm');

                switch(this.chartDateRange) {
                    case '1d': {
                        startDate = date.clone().subtract(1, 'day').format('YYYY-MM-DDTHH:mm');
                        break;
                    }

                    case '1w': {
                        startDate = date.clone().subtract(1, 'week').format('YYYY-MM-DDTHH:mm');
                        break;
                    }

                    case '1m': {
                        startDate = date.clone().subtract(1, 'month').format('YYYY-MM-DDTHH:mm');
                        break;
                    }

                    case '1y': {
                        startDate = date.clone().subtract(1, 'year').format('YYYY-MM-DDTHH:mm');
                        break;
                    }

                    default: {
                        date.clone().subtract(1, 'day').format('YYYY-MM-DDTHH:mm');
                    }
                }

                fetch(`https://production.api.coindesk.com/v2/price/values/${coin}?start_date=${startDate}&end_date=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    let chartData = [],
                        chartLabels = [];

                    for(let entry of data.data.entries) {
                        chartLabels.push(that.$moment(entry[0]).format("YYYY-MM-DDTHH:mm:ss"));
                        chartData.push(entry[1]);
                    }

                    this.data = {
                        labels: chartLabels,
                        datasets: [{
                            label: 'Price',
                            data: chartData,
                            lineTension: 0,
                            pointRadius: 0,
                            borderWidth: 1,
                            borderColor: '#DDDDDD',
                            backgroundColor: '#EEEEEE'
                        }]
                    }

                    this.loaded = true;
                });
            },

            coinDataRaw() {
                return [[1619830799000,0.3341197238],[1619834399000,0.3326465772],[1619837999000,0.3354685178],[1619841599000,0.3416064866],[1619845199000,0.3734114551],[1619848799000,0.3629323197],[1619852399000,0.3608836579],[1619855999000,0.3644182283],[1619859599000,0.3603751926],[1619863199000,0.3554888879],[1619866799000,0.359041974],[1619870399000,0.3575613024],[1619873999000,0.3649765233],[1619877599000,0.3637250891],[1619881199000,0.3594741023],[1619884799000,0.3589055635],[1619888399000,0.3631712927],[1619891999000,0.3647055447],[1619895599000,0.3685887516],[1619899199000,0.3669351653],[1619902799000,0.3675418317],[1619906399000,0.3789431753],[1619909999000,0.3851596652],[1619913599000,0.3910458611],[1619917199000,0.3966083419],[1619920799000,0.3850269058],[1619924399000,0.3920822658],[1619927999000,0.3825445016],[1619931599000,0.3768960286],[1619935199000,0.3803326051],[1619938799000,0.3782736913],[1619942399000,0.3738929783],[1619945999000,0.3688381098],[1619949599000,0.3727262676],[1619953199000,0.3817284019],[1619956799000,0.3781798354],[1619960399000,0.3804794634],[1619963999000,0.3763494575],[1619967599000,0.3796349356],[1619971199000,0.3892350009],[1619974799000,0.3833032179],[1619978399000,0.3860775389],[1619981999000,0.387222988],[1619985599000,0.3881590082],[1619989199000,0.3875111074],[1619992799000,0.3914068907],[1619996399000,0.3784028647],[1619999999000,0.3790795396],[1620003599000,0.3843862666],[1620007199000,0.3818581987],[1620010799000,0.3833229075],[1620014399000,0.3800192656],[1620017999000,0.3816345342],[1620021599000,0.3822495736],[1620025199000,0.3833977449],[1620028799000,0.389979868],[1620032399000,0.3848701774],[1620035999000,0.3838405275],[1620039599000,0.3849527419],[1620043199000,0.3856199113],[1620046799000,0.3906731492],[1620050399000,0.4012432028],[1620053999000,0.3986653392],[1620057599000,0.4016577802],[1620061199000,0.4101235106],[1620064799000,0.4070702949],[1620068399000,0.4122984046],[1620071999000,0.4116492571],[1620075599000,0.4243336736],[1620079199000,0.4342360762],[1620082799000,0.4364162999],[1620086399000,0.4436413616],[1620089999000,0.4292604259],[1620093599000,0.4190254333],[1620097199000,0.4167921987],[1620100799000,0.4202160511],[1620104399000,0.4306187418],[1620107999000,0.4366953444],[1620111599000,0.4346242527],[1620115199000,0.4461935863],[1620118799000,0.4931039503],[1620122399000,0.4820068686],[1620125999000,0.4779984386],[1620129599000,0.4877260103],[1620133199000,0.5366799283],[1620136799000,0.5873364587],[1620140399000,0.55278172],[1620143999000,0.5403239397],[1620147599000,0.5365410722],[1620151199000,0.5788025293],[1620154799000,0.5573138148],[1620158399000,0.560780796],[1620161999000,0.5585720078],[1620165599000,0.5366049984],[1620169199000,0.5425109667],[1620172799000,0.5487231455],[1620176399000,0.5692534771],[1620179999000,0.5919743945],[1620183599000,0.5824240078],[1620187199000,0.6475386918],[1620190799000,0.6607637304],[1620194399000,0.6847619565],[1620197999000,0.6732458048],[1620201599000,0.6717772852],[1620205199000,0.637620073],[1620208799000,0.6602069055],[1620212399000,0.6724362354],[1620215999000,0.6641873159],[1620219599000,0.6710446101],[1620223199000,0.661554052],[1620226799000,0.6534835285],[1620230399000,0.6158070961],[1620233999000,0.606604295],[1620237599000,0.6260018618],[1620241199000,0.6086355451],[1620244799000,0.6169105588],[1620248399000,0.6106251577],[1620251999000,0.6363921159],[1620255599000,0.6416045016],[1620259199000,0.6534817735],[1620262799000,0.6371480977],[1620266399000,0.635024092],[1620269999000,0.6497386389],[1620273599000,0.6224386261],[1620277199000,0.6173419011],[1620280799000,0.6146458416],[1620284399000,0.5977772504],[1620287999000,0.611712605],[1620291599000,0.6082880288],[1620295199000,0.6003474093],[1620298799000,0.5999864129],[1620302399000,0.6137851935],[1620305999000,0.6020348718],[1620309599000,0.592461353],[1620313199000,0.6090051215],[1620316799000,0.5997581462],[1620320399000,0.6006861944],[1620323999000,0.5958640882],[1620327599000,0.5532437413],[1620331199000,0.5748545374],[1620334799000,0.6000820251],[1620338399000,0.5884676805],[1620341999000,0.586173406],[1620345599000,0.5798646862],[1620349199000,0.5656733845],[1620352799000,0.5503186369],[1620356399000,0.5218952113],[1620359999000,0.5883092045],[1620363599000,0.5779458851],[1620367199000,0.5712753738],[1620370799000,0.5930126648],[1620374399000,0.6375594919],[1620377999000,0.6183406635],[1620381599000,0.6148634021],[1620385199000,0.6264256527],[1620388799000,0.6189424419],[1620392399000,0.6028713948],[1620395999000,0.611050377],[1620399599000,0.6033209355],[1620403199000,0.6083091999],[1620406799000,0.611413145],[1620410399000,0.6115744099],[1620413999000,0.6267184963],[1620417599000,0.6377951393],[1620421199000,0.6405889782],[1620424799000,0.6676017944],[1620428399000,0.7223204769],[1620431999000,0.6868112849],[1620435599000,0.6786685133],[1620439199000,0.6879993545],[1620442799000,0.6958663675],[1620446399000,0.7092626793],[1620449999000,0.7194538698],[1620453599000,0.7250021173],[1620457199000,0.7199209181],[1620460799000,0.7008436617],[1620464399000,0.7042571974],[1620467999000,0.7085945344],[1620471599000,0.7115338581],[1620475199000,0.7173583386],[1620478799000,0.7246577281],[1620482399000,0.7075985063],[1620485999000,0.716813088],[1620489599000,0.6684937613],[1620493199000,0.6571377344],[1620496799000,0.6718863438],[1620500399000,0.6572685093],[1620503999000,0.6783960181],[1620507599000,0.6815767393],[1620511199000,0.65460604],[1620514799000,0.6436801234],[1620518399000,0.6331772498],[1620521999000,0.6688545189],[1620525599000,0.6653319148],[1620529199000,0.629630396],[1620532799000,0.6608226856],[1620536399000,0.5626994529],[1620539999000,0.5642535301],[1620543599000,0.5405286471],[1620547199000,0.5303950879],[1620550799000,0.5293862324],[1620554399000,0.4916362359],[1620557999000,0.488008754],[1620561599000,0.4790486587],[1620565199000,0.4515310181],[1620568799000,0.4835738358],[1620572399000,0.4845200929],[1620575999000,0.5009139888],[1620579599000,0.491483382],[1620583199000,0.5417710031],[1620586799000,0.5638224539],[1620590399000,0.5875109096],[1620593999000,0.5665751107],[1620597599000,0.5508468406],[1620601199000,0.585158958],[1620604799000,0.5706973462],[1620608399000,0.5652862073],[1620611999000,0.5680347783],[1620615599000,0.5422564626],[1620619199000,0.5232634775],[1620622799000,0.5449235574],[1620626399000,0.5281223838],[1620629999000,0.5403961331],[1620633599000,0.5492763512],[1620637199000,0.5329369209],[1620640799000,0.5187455146],[1620644399000,0.5121071103],[1620647999000,0.5123016137],[1620651599000,0.5147313558],[1620655199000,0.5035825856],[1620658799000,0.4986613283],[1620662399000,0.5177326608],[1620665999000,0.4992998774],[1620669599000,0.4855898426],[1620673199000,0.4677647438],[1620676799000,0.455684178],[1620680399000,0.4553092604],[1620683999000,0.4759886271],[1620687599000,0.456113233],[1620691199000,0.4493986597],[1620694799000,0.464113965],[1620698399000,0.4562814695],[1620701999000,0.4582018727],[1620705599000,0.4639016074],[1620709199000,0.484452394],[1620712799000,0.4706380783],[1620716399000,0.4765161227],[1620719999000,0.4637163253],[1620723599000,0.5227878727],[1620727199000,0.5228706778],[1620730799000,0.5036990014],[1620734399000,0.5077439905],[1620737999000,0.4920076198],[1620741599000,0.4904675602],[1620745199000,0.5048543439],[1620748799000,0.5026168732],[1620752399000,0.4933591488],[1620755999000,0.5009014246],[1620759599000,0.504683229],[1620763199000,0.508791393],[1620766799000,0.5140519487],[1620770399000,0.5027575514],[1620773999000,0.5024757846],[1620777599000,0.4948696004],[1620781199000,0.4927508375],[1620784799000,0.5004941354],[1620788399000,0.4937518619],[1620791999000,0.4911332175],[1620795599000,0.4928815473],[1620799199000,0.4935420438],[1620802799000,0.4999434059],[1620806399000,0.5089525286],[1620809999000,0.5043895623],[1620813599000,0.5003780356],[1620817199000,0.4930622382],[1620820799000,0.4969493708],[1620824399000,0.494433848],[1620827999000,0.4919559283],[1620831599000,0.4895846805],[1620835199000,0.4770568234],[1620838799000,0.453326555],[1620842399000,0.4675314569],[1620845999000,0.4363213519],[1620849599000,0.4637355025],[1620853199000,0.4676085863],[1620856799000,0.4682197748],[1620860399000,0.4519935089],[1620863999000,0.4316314837],[1620867599000,0.4205866316],[1620871199000,0.4293309386],[1620874799000,0.4494230782],[1620878399000,0.4295221256],[1620881999000,0.443343705],[1620885599000,0.4416299543],[1620889199000,0.4382360264],[1620892799000,0.4317450846],[1620896399000,0.4181634323],[1620899999000,0.3946872806],[1620903599000,0.4011562992],[1620907199000,0.3976388197],[1620910799000,0.4088100273],[1620914399000,0.4186487461],[1620917999000,0.4271584401],[1620921599000,0.4076090104],[1620925199000,0.412553788],[1620928799000,0.3892500725],[1620932399000,0.3840372966],[1620935999000,0.3914457787],[1620939599000,0.3960228159],[1620943199000,0.4143429115],[1620946799000,0.4300419337],[1620950399000,0.4778494779],[1620953999000,0.4855496745],[1620957599000,0.4812457695],[1620961199000,0.4874566326],[1620964799000,0.4911785721],[1620968399000,0.5091803782],[1620971999000,0.5218362288],[1620975599000,0.5610902983],[1620979199000,0.5336904859],[1620982799000,0.5277801634],[1620986399000,0.5243039797],[1620989999000,0.5268117888],[1620993599000,0.5278676749],[1620997199000,0.5358656547],[1621000799000,0.5307474106],[1621004399000,0.5409856352],[1621007999000,0.5459109194],[1621011599000,0.5428613775],[1621015199000,0.5561075584],[1621018799000,0.5752029279],[1621022399000,0.5705611563],[1621025999000,0.5539033753],[1621029599000,0.5505902843],[1621033199000,0.5550034809],[1621036799000,0.5653773298],[1621040399000,0.5472379757],[1621043999000,0.5527037447],[1621047599000,0.5494457532],[1621051199000,0.5321098752],[1621054799000,0.5282910452],[1621058399000,0.5350833623],[1621061999000,0.5275605844],[1621065599000,0.5204698443],[1621069199000,0.5201024683],[1621072799000,0.5210150975],[1621076399000,0.5082119411],[1621079999000,0.5140062731],[1621083599000,0.5258099183],[1621087199000,0.5297645175],[1621090799000,0.516006198],[1621094399000,0.5164423496],[1621097999000,0.5006556903],[1621101599000,0.5104065938],[1621105199000,0.5056534543],[1621108799000,0.5064299698],[1621112399000,0.5185088947],[1621115999000,0.5241028276],[1621119599000,0.5109660608],[1621123199000,0.5077742926],[1621126799000,0.5137588526],[1621130399000,0.5319481581],[1621133999000,0.5420151576],[1621137599000,0.5301805669],[1621141199000,0.5301237167],[1621144799000,0.5316801955],[1621148399000,0.5389140675],[1621151999000,0.5315699772],[1621155599000,0.5286260134],[1621159199000,0.5321715719],[1621162799000,0.5300397483],[1621166399000,0.5287402148],[1621169999000,0.519355039],[1621173599000,0.5201635597],[1621177199000,0.5168155044],[1621180799000,0.5120695419],[1621184399000,0.5090143141],[1621187999000,0.5314358764],[1621191599000,0.516762686],[1621195199000,0.5095591432],[1621198799000,0.5040740724],[1621202399000,0.4939167111],[1621205999000,0.4924255373],[1621209599000,0.5116865797],[1621213199000,0.5107159919],[1621216799000,0.4961269786],[1621220399000,0.4904441729],[1621223999000,0.4780814233],[1621227599000,0.4791584931],[1621231199000,0.4744357549],[1621234799000,0.4880688258],[1621238399000,0.505268827],[1621241999000,0.5089209861],[1621245599000,0.502955929],[1621249199000,0.5029254672],[1621252799000,0.5054141744],[1621256399000,0.5066827279],[1621259999000,0.4997982767],[1621263599000,0.4893792708],[1621267199000,0.4803120386],[1621270799000,0.4830185895],[1621274399000,0.4769439222],[1621277999000,0.4849349064],[1621281599000,0.490264402],[1621285199000,0.4988126047],[1621288799000,0.4900652364],[1621292399000,0.4822827545],[1621295999000,0.48887734],[1621299599000,0.4886347995],[1621303199000,0.4907807027],[1621306799000,0.4923514929],[1621310399000,0.4928780034],[1621313999000,0.502050358],[1621317599000,0.4966017555],[1621321199000,0.4967687424],[1621324799000,0.4928196101],[1621328399000,0.4928984544],[1621331999000,0.4942597237],[1621335599000,0.5001450349],[1621339199000,0.5008998708],[1621342799000,0.4870989004],[1621346399000,0.4852344881],[1621349999000,0.4762245332],[1621353599000,0.4780906635],[1621357199000,0.480425633],[1621360799000,0.4820067727],[1621364399000,0.4763473977],[1621367999000,0.4794064344],[1621371599000,0.4777708755],[1621375199000,0.4781215594],[1621378799000,0.4805031368],[1621382399000,0.476554627],[1621385999000,0.4749110801],[1621389599000,0.4479192881],[1621393199000,0.4423441351],[1621396799000,0.4342665855],[1621400399000,0.3914610958],[1621403999000,0.4096307287],[1621407599000,0.4139406608],[1621411199000,0.4188146406],[1621414799000,0.4212977206],[1621418399000,0.4194794617],[1621421999000,0.4028257961],[1621425599000,0.3793994395],[1621429199000,0.3318559091],[1621432799000,0.3610868927],[1621436399000,0.3326905245],[1621439999000,0.4029436334],[1621443599000,0.4040232869],[1621447199000,0.3789668137],[1621450799000,0.3556590865],[1621454399000,0.3610166763],[1621457999000,0.3567900405],[1621461599000,0.3492965493],[1621465199000,0.3681395042],[1621468799000,0.3454361092],[1621472399000,0.3108986457],[1621475999000,0.3155474637],[1621479599000,0.3286214117],[1621483199000,0.3357740949],[1621486799000,0.3464240163],[1621490399000,0.3559988197],[1621493999000,0.3630966069],[1621497599000,0.3800739238],[1621501199000,0.3656915939],[1621504799000,0.3596992326],[1621508399000,0.4208206388],[1621511999000,0.4004816934],[1621515599000,0.4236138884],[1621519199000,0.407389071],[1621522799000,0.4176127544],[1621526399000,0.4176854141],[1621529999000,0.3826216958],[1621533599000,0.4011202673],[1621537199000,0.4002007921],[1621540799000,0.4056382828],[1621544399000,0.3995982259],[1621547999000,0.4087813026],[1621551599000,0.3960534219],[1621555199000,0.3991983237],[1621558799000,0.4102403046],[1621562399000,0.4083210965],[1621565999000,0.40041048],[1621569599000,0.399174167],[1621573199000,0.3893194048],[1621576799000,0.3933860073],[1621580399000,0.3896718646],[1621583999000,0.3878689926],[1621587599000,0.3848332848],[1621591199000,0.394771603],[1621594799000,0.395548073],[1621598399000,0.3880615066],[1621601999000,0.390124919],[1621605599000,0.3923986174],[1621609199000,0.3624260232],[1621612799000,0.358214811],[1621616399000,0.3598469265],[1621619999000,0.3566828112],[1621623599000,0.3584739925],[1621627199000,0.3386425797],[1621630799000,0.3402283025],[1621634399000,0.3508768136],[1621637999000,0.3574657668],[1621641599000,0.3554577238],[1621645199000,0.3516950919],[1621648799000,0.3570699149],[1621652399000,0.3421833894],[1621655999000,0.3362353076],[1621659599000,0.3344410953],[1621663199000,0.3254054098],[1621666799000,0.3253894196],[1621670399000,0.3305698904],[1621673999000,0.3475042746],[1621677599000,0.3471974381],[1621681199000,0.3492188955],[1621684799000,0.3491812651],[1621688399000,0.352428743],[1621691999000,0.3552328721],[1621695599000,0.3426777429],[1621699199000,0.3466790775],[1621702799000,0.3429145129],[1621706399000,0.3334387724],[1621709999000,0.3352213186],[1621713599000,0.3413216826],[1621717199000,0.3472338962],[1621720799000,0.3417803618],[1621724399000,0.3435665149],[1621727999000,0.3446577671],[1621731599000,0.3491685101],[1621735199000,0.347297024],[1621738799000,0.3433617811],[1621742399000,0.3485361673],[1621745999000,0.3465789363],[1621749599000,0.3425877165],[1621753199000,0.3383697309],[1621756799000,0.3341571019],[1621760399000,0.318588239],[1621763999000,0.3162019453],[1621767599000,0.3274589475],[1621771199000,0.3217996142],[1621774799000,0.2936549092],[1621778399000,0.287525109],[1621781999000,0.3040111348],[1621785599000,0.2885402898],[1621789199000,0.2499735056],[1621792799000,0.2986961321],[1621796399000,0.2873874342],[1621799999000,0.2859376613],[1621803599000,0.2960209797],[1621807199000,0.3058178388],[1621810799000,0.3091838217],[1621814399000,0.3057240628],[1621817999000,0.308605935],[1621821599000,0.3039216879],[1621825199000,0.299472829],[1621828799000,0.3070947857],[1621832399000,0.2961141858],[1621835999000,0.3075053646],[1621839599000,0.3116145589],[1621843199000,0.3298969555],[1621846799000,0.3266407994],[1621850399000,0.3227774309],[1621853999000,0.3197227394],[1621857599000,0.3319365438],[1621861199000,0.3443338354],[1621864799000,0.3332222197],[1621868399000,0.3301819412],[1621871999000,0.3345855119],[1621875599000,0.3279949838],[1621879199000,0.3275420797],[1621882799000,0.3327814322],[1621886399000,0.3370194344],[1621889999000,0.3591980429],[1621893599000,0.3534261987],[1621897199000,0.3490122229],[1621900799000,0.3674483382],[1621904399000,0.3805656598],[1621907999000,0.3583999081],[1621911599000,0.3549860014],[1621915199000,0.3433595933],[1621918799000,0.3465820757],[1621922399000,0.3490087595],[1621925999000,0.3590129908],[1621929599000,0.3567096653],[1621933199000,0.348546887],[1621936799000,0.3483010847],[1621940399000,0.3267649435],[1621943999000,0.337958345],[1621947599000,0.332158111],[1621951199000,0.3470106354],[1621954799000,0.3465781639],[1621958399000,0.3440143213],[1621961999000,0.340935224],[1621965599000,0.3414957812],[1621969199000,0.3432538074],[1621972799000,0.3414126288],[1621976399000,0.3356870221],[1621979999000,0.3423749207],[1621983599000,0.3486084997],[1621987199000,0.3455944049],[1621990799000,0.3412213514],[1621994399000,0.3501346047],[1621997999000,0.3503020543],[1622001599000,0.3546218084],[1622005199000,0.3522924046],[1622008799000,0.3573954373],[1622012399000,0.3631420458],[1622015999000,0.3638400072],[1622019599000,0.357693445],[1622023199000,0.3572388716],[1622026799000,0.3518948194],[1622030399000,0.3534313148],[1622033999000,0.3559793278],[1622037599000,0.3465459735],[1622041199000,0.3475851522],[1622044799000,0.3439267002],[1622048399000,0.3442978877],[1622051999000,0.3455114925],[1622055599000,0.3441656063],[1622059199000,0.3424556156],[1622062799000,0.3452657484],[1622066399000,0.3442695129],[1622069999000,0.3472869293],[1622073599000,0.353367954],[1622077199000,0.3431297866],[1622080799000,0.341189095],[1622084399000,0.3374363829],[1622087999000,0.3338666085],[1622091599000,0.3337233179],[1622095199000,0.3340185498],[1622098799000,0.3394187223],[1622102399000,0.3386885777],[1622105999000,0.3428541021],[1622109599000,0.3441584762],[1622113199000,0.3430096142],[1622116799000,0.3447126877],[1622120399000,0.3422472974],[1622123999000,0.3433850718],[1622127599000,0.3417343363],[1622131199000,0.3395598949],[1622134799000,0.3372085292],[1622138399000,0.3359835544],[1622141999000,0.3355767665],[1622145599000,0.3315380091],[1622149199000,0.3338083444],[1622152799000,0.3390285072],[1622156399000,0.33306692],[1622159999000,0.3345819766],[1622163599000,0.3331931102],[1622167199000,0.3307111539],[1622170799000,0.3326636922],[1622174399000,0.3323209866],[1622177999000,0.3346069967],[1622181599000,0.328181028],[1622185199000,0.317603563],[1622188799000,0.3183845377],[1622192399000,0.3252013585],[1622195999000,0.3121550131],[1622199599000,0.3145317289],[1622203199000,0.3066022565],[1622206799000,0.3141847837],[1622210399000,0.3166136062],[1622213999000,0.3156253383],[1622217599000,0.3216520489],[1622221199000,0.3128444044],[1622224799000,0.3156257233],[1622228399000,0.3155059286],[1622231999000,0.3150995522],[1622235599000,0.3136945622],[1622239199000,0.3061403436],[1622242799000,0.3047765834],[1622246399000,0.3103935576],[1622249999000,0.313109477],[1622253599000,0.31638322],[1622257199000,0.3144296241],[1622260799000,0.3157920709],[1622264399000,0.3144655367],[1622267999000,0.3164480384],[1622271599000,0.314468104],[1622275199000,0.3107107635],[1622278799000,0.3070644507],[1622282399000,0.3033473851],[1622285999000,0.3043324658],[1622289599000,0.3048435175],[1622293199000,0.2986295446],[1622296799000,0.2936284627],[1622300399000,0.2926014222],[1622303999000,0.2869127332],[1622307599000,0.2952978431],[1622311199000,0.2913088095],[1622314799000,0.2924509936],[1622318399000,0.2931237829],[1622321999000,0.2950619593],[1622325599000,0.2969856124],[1622329199000,0.2985486152],[1622332799000,0.304693212],[1622336399000,0.2900848996],[1622339999000,0.2893844693],[1622343599000,0.2962086794],[1622347199000,0.2958613159],[1622350799000,0.2997260653],[1622354399000,0.3034429468],[1622357999000,0.3069242585],[1622361599000,0.3092968313],[1622365199000,0.3045258634],[1622368799000,0.3052515152],[1622372399000,0.3070271316],[1622375999000,0.3049195811],[1622379599000,0.3051195924],[1622383199000,0.3006267465],[1622386799000,0.2983076612],[1622390399000,0.2987761862],[1622393999000,0.3030787879],[1622397599000,0.3050843257],[1622401199000,0.3080159474],[1622404799000,0.3083193561],[1622408399000,0.3056521067],[1622411999000,0.3036814905],[1622415599000,0.3036249146],[1622419199000,0.3026817774],[1622422799000,0.3000853583],[1622426399000,0.2969769158],[1622429999000,0.2991007767],[1622433599000,0.2968452129],[1622437199000,0.2967151003],[1622440799000,0.2971772532],[1622444399000,0.2997487914],[1622447999000,0.3039596722],[1622451599000,0.3049343427],[1622455199000,0.3055933841],[1622458799000,0.3143572614],[1622462399000,0.3148181129],[1622465999000,0.3082811326],[1622469599000,0.309672044],[1622473199000,0.3069517871],[1622476799000,0.3130755547],[1622480399000,0.3140670022],[1622483999000,0.3117256498],[1622487599000,0.3142138313]];
            },

            coinData() {
                let coins = this.coinDataRaw(),
                    data = [],
                    labels = [];

                for(let coin of coins) {
                    labels.push(this.$moment(coin[0]).format("YYYY-MM-DDTHH:mm:ss"));
                    data.push(coin[1]);
                }

                return {
                    labels: labels,
                    datasets: [{
                        label: 'Price',
                        data: data,
                        lineTension: 0,
                        fill: false,
                        pointRadius: 0,
                        borderColor: "#94b5c2",
                    }]
                };
            },

            chartOptions() {
                let that = this;

                let xAxesDates = true;

                switch(this.chartDateRange) {
                    case '1d': {
                        xAxesDates = false;
                        break;
                    }

                    default: {
                        xAxesDates = true;
                    }
                }

                return {
                    responsive: true,
                    maintainAspectRatio: false,
                    spanGaps: true,
                    legend: {
                        display: false,
                    },
                    layout: {
                        padding: 0,
                    },
                    tooltips: {
                        enabled: true,
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function (tooltipItem, data) {
                                return (tooltipItem.yLabel * that.currencyRate).toLocaleString("en-GB",{style:"currency", currency:that.selectedCurrency});
                            },

                            title: function (tooltipItem, data) {
                                return that.$moment(tooltipItem[0].label).format("DD/MM/YYYY HH:mm");
                            },
                        },
                    },
                    scales: {
                        xAxes: [
                            {
                                display: false,
                                ticks: {
                                    autoSkip: true,
                                    maxTicksLimit: 5,
                                    maxRotation: 0,
                                    minRotation: 0,
                                    callback: function(value, index, values) {
                                        if(xAxesDates) {
                                            return that.$moment(value).format("DD/MM/YYYY");
                                        } else {
                                            return that.$moment(value).format("HH:mm");
                                        }
                                    }
                                }
                            }
                        ],
                        yAxes: [
                            {
                                display: false,
                                ticks: {
                                    callback: function(value, index, values) {
                                        return (value * that.currencyRate).toLocaleString("en-GB",{style:"currency", currency:that.selectedCurrency});
                                    }
                                }
                            }
                        ]
                    },
                    hover: {
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        },

        computed: {
            selectedCoin() {
                return this.$store.state.selectedCoin;
            },

            selectedCurrency() {
                return this.$store.state.selectedCurrency;
            },

            currencyRate() {
                return this.$store.state.currencyRate;
            },

            chartDateRange() {
                return this.$store.state.chartDateRange;
            }
        },

        watch: {
            selectedCoin() {
                this.getData();
            },

            selectedCurrency() {
                this.getData();
            },

            chartDateRange() {
                this.getData();
            },
        },

        mounted() {
            this.getData();
        }
    }
</script>
